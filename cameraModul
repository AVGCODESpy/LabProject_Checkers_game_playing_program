%We first read image and distinguish objects(checker pieces) on it
im = imread('Checkers_board.png', 'png');
im2 = rgb2gray(im);
im3 = imbinarize(im2, 0.6);
im4 = imopen(im3, strel('disk', 2));
im5 = imcomplement(im4);
im6 = imopen(im5, strel('disk', 10));

[labels, numlabels] = bwlabel(im6);

Board = zeros(8, 8); %Here we create matrix that would represent the board

R = im(:, :, 1);
G = im(:, :, 2);
B = im(:, :, 3);
% We extract the red, green, and blue channels separately for color analysis

stats = regionprops(labels, 'all');

% We know that first object is of black pieces and second of white, so by
% looking at the color of those object we can distinguish oponents' pieces
% from ours
idx1 = stats(1).PixelIdxList;
obj1Color = [mean(R(idx1)), mean(G(idx1)), mean(B(idx1))];
idx2 = stats(2).PixelIdxList;
obj2Color = [mean(R(idx2)), mean(G(idx2)), mean(B(idx2))];

% here we look at the size of the image so we can know 
% how big one square is 
[H, W, ~] = size(im);
squareW = W / 8;
squareH = H / 8;


for i = 1:numlabels
    % We look at the colot of the object and its location
    idx = stats(i).PixelIdxList;
    loc = stats(i).Centroid;
    color = [mean(R(idx)), mean(G(idx)), mean(B(idx))];
    col = ceil(loc(1) / squareW);
    row = ceil(loc(2) / squareH);
    
    %If the color shows that it is our piece we put value 1,
    %if not, then we put value 2
    if color(1) > color(2) && color(1) > color(3)
        Board(row, col) = 1;
    else
        Board(row, col) = 2;
    end
end

% Here we print the board to check if it is done correctly 
disp('Board (rows 1 to 8):');
for row = 1:8
    fprintf('%d %d %d %d %d %d %d %d\n', Board(row, :));
end

BoardNew = zeros(8, 8);
value1 = 8;
value2 = 8;

while true
    for i = 1:numlabels
        idx = stats(i).PixelIdxList;
        loc = stats(i).Centroid;
        color = [mean(R(idx)), mean(G(idx)), mean(B(idx))];
        if color(1) > color(2) && color(1) > color(3)
            BoardNew(row, col) = 1;
        else
            BoardNew(row, col) = 2;
        end
    end
    if BoardNew ~= Board
        
end

